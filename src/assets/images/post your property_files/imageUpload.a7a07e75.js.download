define("doT!modules/listProperty/views/imageUpload",function(){return function(e){var t='<section id="'+e.moduleId+'" class="row no-margin" data-lazyModule="imageProcessing" data-loadOn="event"> <script type="text/x-config">{ "id": "'+e.moduleId+'", "parentId": "'+e.parentId+'", "multi":true, "maxSize": 7000000, "tagCheck": true, "selector": ".picedit_box", "fullCrop": false, "preview": true, "inputName": "image", "objectType": "user", "objectId": '+e.sellerId+', "addWaterMark": true, "maxWidth": 400, "maxHeight": 300, "imgMinWidth": 360, "imgMinHeight": 270, "maxImages": '+e.maxImages+', "deviceType": "'+e.deviceType+'" }  </script></section><p class="error"></p>';return t}}),define("doT!modules/listProperty/views/imageThumb",function(){return function(e){var t='<div data-module="controls" class="js-image-tag" id="';if(t+=e.inactiveMedia?"inactiveImageTag":"imageTag",t+=e.index+'"><script type="text/x-config">{"type": "',"mobile"===e.device?t+="selectList":"mobile"!==e.device&&(t+="inputBox"),t+='","label": "tag image","error": "Please Tag Image","broadcastValueChange": true, "controlReference": "imageTag"}</script></div><div class="radio-button image-title ',e.inactiveMedia&&(t+="hide"),t+='"><input type="radio" name="titleimage" id="',e.inactiveMedia&&(t+="inactiveImage-"),t+="title-image"+e.index+'" data-type="make_title" aria-label="Title image" /> <label for="',e.inactiveMedia&&(t+="inactiveImage-"),t+="title-image"+e.index+'"><span class="radio"></span><p class="inactive">make display image</p><p class="active">selected display image</p></label></div>',e.inactiveMedia&&(t+="<div class=\"image-rejection-reason\"><p class='js-reason'><span>Reason: </span>"+e.rejectionReason+"</p></div>"),e.isScreening){t+='<div class="hover-img">';var i=e.rawsrc?e.rawsrc:e.src;t+='<a href="'+i+'" target="_blank" title="zoomed image"><img src="'+i+'" alt="zoomed image" /></a></div><span class="approved hide">approved</span>'}return t}}),define("doT!modules/imageProcessing/views/imageActions",function(){return function(e){var t='<ul class="image-action" role="navigation"> <li class="edit-control" role="presentation"> <label title="rotate 90CW" data-type="rotate_cw"> <span class="icon-line-rotate"></span> <label>rotate</label> </label> </li> <li class="edit-control" role="presentation"> <label title="crop image" data-type="crop_open"> <span class="icon-line-crop"></span> <label>crop</label> </label> </li> ';return e.inactiveMedia?t+=' <li  class="edit-control" role="presentation"> <label title="add image" data-type="add_image"> <span class="icon-add"></span> <label>restore</label> </label> </li> ':(t+=' <li  class="edit-control" role="presentation"> <label title="remove image" data-type="',t+=e.isScreening?"remove_image_screening":"remove_image",t+='"> <span class="icon-line-delete"></span> <label>delete</label> </label> </li> '),t+="</ul>"}}),define("modules/listProperty/scripts/services/notification",[],function(){var e="notificationService";return Box.Application.addService(e,function(){function e(e){}var t=5e3,i=$(".notification-container"),a=($(".notification-progress"),function(){i.attr("class","notification-container");var e="show "+arguments[1]||"show",a=arguments[2]||t;i.addClass(e).find("h3").text(arguments[0]).delay(a).queue(function(t){i.removeClass(e),t()})});return{show:a,hide:e}}),Box.Application.getService(e)}),define("modules/listProperty/scripts/services/storageService",["services/apiService"],function(){return Box.Application.addService("storageService",function(){var e=(Box.Application.getService("ApiService"),function(e,t){"undefined"!=typeof Storage&&e?sessionStorage[e]=JSON.stringify(t):console.log("Sorry! No Web Storage support..")}),t=function(e){return"undefined"!=typeof Storage&&sessionStorage[e]?JSON.parse(sessionStorage[e]):void 0},i=function(e){sessionStorage.removeItem(e)};return{get:t,set:e,remove:i}}),Box.Application.getService("storageService")}),define("modules/listProperty/scripts/services/imageService",["modules/controls/scripts/controlsService","modules/listProperty/scripts/services/storageService"],function(){Box.Application.addService("imageService",function(){function e(e){return e=e.map(function(e){return parseInt(e,10)})}var t=(Box.Application.getGlobal("jQuery"),Box.Application.getService("controlsService")),i=Box.Application.getService("ApiService"),a=(Box.Application.getService("storageService"),{getImages:"/xhr/listingService/getImages?filters=({{imageIdsString}})",getImageRejectionReason:"/xhr/data/getMasterImageRejectionReason"}),o=function(e){var t="id=="+e.join(",id=="),o=a.getImages.replace("{{imageIdsString}}",t);return i.get(o,"",!0)},n=function(t,i,a,o){return t.height>269&&t.width>359?!0:(i=e(i),i.splice(i.indexOf(t.id),1),i=i.length>0?i:[],a.push(t.id),!1)},r=function(e,i,a,o){void 0===e&&(e=[]),void 0===i&&(i={}),void 0===a&&(a={});var n=arguments.length<=4||void 0===arguments[4]?[]:arguments[4];"imageUpload"!=o?t.set("inactiveImageUrls",e.join(",")):t.set("imageUrls",e.join(","));var r=t.get("imageTypes")?JSON.parse(t.get("imageTypes")):{},s=t.get("imagesData")?JSON.parse(t.get("imagesData")):{};t.set("imageTypes",JSON.stringify(Object.assign(r,i))),t.set("imagesData",JSON.stringify(Object.assign(s,a))),Box.Application.broadcast("draw_images",{id:o}),t.get("isScreening")&&"imageUpload"==o&&Box.Application.broadcast("setImagesCount",{imagesCount:e.length,verifiedImagesIdArray:n})},s=function(e,i,a){if(e){var o=[],s={},c={},l=void 0,d=void 0;l="imageUpload"==i?t.get("imageIds")?t.get("imageIds").split(","):[]:t.get("inactiveImageIds")?t.get("inactiveImageIds").split(","):[],d=t.get("deleteMediaIds")?t.get("deleteMediaIds").split(","):[];for(var g=0;g<e.length;g++){var p=e[g],m=p.absolutePath.replace("content.","seller-content."),u=p.absolutePath.replace(/^.*[\\\/]/,"");if(274===p.imageTypeId)var f=JSON.parse(p.jsonDump).imageTypeId;else var f=p.imageTypeId;n(p,l,d,i)&&(o.push(m),s[u]=f,c[u]=p)}"imageUpload"==i?t.set("imageIds",l.join(",")):t.set("inactiveImageIds",l.join(",")),t.set("deleteMediaIds",d.join(",")),r(o,s,c,i,a)}},c=function(){var e=t.fieldsMap.imageRejectionReason||[];0==e.length&&i.get(a.getImageRejectionReason).then(function(e){t.fieldsMap.imageRejectionReason=e&&e.length?e:[]},function(e){t.fieldsMap.imageRejectionReason=[]})};return{loadImg:function(e,t,i){o(e).then(function(e){e&&s(e,t,i)},function(e){throw e})},getMasterImageRejectionReason:c}})}),define("modules/iconList/scripts/iconListService",[],function(){return Box.Application.addService("iconListService",function(e){var t={},i={amenities:[{icon:"parking",text:"Car Parking"},{icon:"power-backup",text:"Power Backup"},{icon:"security",text:"24 X 7 Security"},{icon:"lift",text:"Lift",notSupportedPropertyType:["plot"]},{icon:"swimming-pool",text:"Swimming Pool",notSupportedPropertyType:["shop","office"]},{icon:"garden-park",text:"Landscaped Gardens",notSupportedPropertyType:["shop","office"]},{icon:"gym",text:"Gym",notSupportedPropertyType:["shop","office"]},{icon:"children-play",text:"Children's play area",notSupportedPropertyType:["shop","office"]},{icon:"club",text:"Club House",notSupportedPropertyType:["shop","office"]},{icon:"coffe",text:"Cafeteria"},{icon:"golf",text:"Golf Course",notSupportedPropertyType:["shop","office"]},{icon:"multi-purpose-room",text:"Multipurpose Room",notSupportedPropertyType:["shop","office"]},{icon:"football",text:"Sports Facility",notSupportedPropertyType:["shop","office"]},{icon:"weather",text:"Rain Water Harvesting",notSupportedPropertyType:["shop","office"]},{icon:"intercom",text:"Intercom"},{icon:"road",text:"Jogging Track",notSupportedPropertyType:["shop","office"]},{icon:"racket",text:"Indoor Games",notSupportedPropertyType:["shop","office"]},{icon:"maintenance-staff",text:"Maintenance Staff",notSupportedPropertyType:["shop","office"]},{icon:"servant-room",text:"Staff Quarter",notSupportedPropertyType:["shop","office"]},{icon:"vaastu",text:"Vaastu Compliant",notSupportedPropertyType:["shop","office"]},{icon:"malls",text:"Shopping Mall",notSupportedPropertyType:["shop","office"]},{icon:"school",text:"School",notSupportedPropertyType:["shop","office"]},{icon:"hospitals",text:"Hospital",notSupportedPropertyType:["shop","office"]},{icon:"atm",text:"ATM",notSupportedPropertyType:["shop","office"]},{icon:"ac",text:"Air Conditioned",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"cctv-camera",text:"CCTV Camera",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"conference-room",text:"Conference Room",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"fire-sprinklers",text:"Fire Sprinklers",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"wifi",text:"Internet/ Wi-Fi Connectivity",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"ro-water-system",text:"RO Water System",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"service-lift",text:"Service/Goods Lift",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"reserved-parking",text:"Reserved Parking",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"visitor-parking",text:"Visitor Parking",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"water-supply",text:"Water Supply",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]},{icon:"water-storage",text:"Water Storage",notSupportedPropertyType:["apartment","builderfloor","farmhouse","villa","plot","penthouse","studio","independenthouse"]}],pgAmenities:[{icon:"power-backup",text:"Power Backup"},{icon:"security",text:"24 X 7 Security"},{icon:"lift",text:"Lift"},{icon:"swimming-pool",text:"Swimming Pool"},{icon:"gym",text:"Gym"},{icon:"club",text:"Club House"},{icon:"football",text:"Sports Facility"},{icon:"intercom",text:"Intercom"},{icon:"maintenance-staff",text:"Maintenance Staff"},{icon:"gated-community",text:"Gated Community"}],furnishing:[{icon:"sofa",text:"Sofa"},{icon:"fridge",text:"Refrigerator"},{icon:"dining-table",text:"Dining Table"},{icon:"gas",text:"Gas Connection"},{icon:"washing",text:"Washing Machine"},{icon:"wifi-connection",text:"Wifi Connection"},{icon:"microwave",text:"Microwave"},{icon:"modular-kitchen",text:"Modular Kitchen"}],pgFurnishing:[{icon:"sofa",text:"Sofa"},{icon:"fridge",text:"Refrigerator"},{icon:"dining-table",text:"Dining Table"},{icon:"gas",text:"Gas Connection"},{icon:"washing",text:"Washing Machine"},{icon:"pg-geyser",text:"Geyser"},{icon:"pg-water-purifier",text:"Water Purifier"},{icon:"microwave",text:"Microwave"},{icon:"pg-cooler",text:"Cooler"},{icon:"pg-study-room",text:"Study Table"},{icon:"pg-stove",text:"Stove"}],additionalRoom:[{icon:"prayer",text:"Prayer Room"},{icon:"study-room",text:"Study Room"},{icon:"store-room",text:"Store Room"},{icon:"servant-room",text:"Servant Room"}],totalPriceInclude:[{icon:"plc",text:"PLC"},{icon:"parking",text:"Car Parking"},{icon:"club-membership",text:"Club Membership"},{icon:"idc",text:"EDC / IDC"},{icon:"registration",text:"Registration"}],overlooking:[{icon:"garden-park",text:"Garden / Park"},{icon:"swimming-pool",text:"Pool"},{icon:"road",text:"Road"},{icon:"city",text:"Corner Property"}],cParking:[{icon:"parking-covered",text:"Covered"}],oParking:[{icon:"open-parking",text:"Open"}],roomTypes:[{icon:"pg-user-simple",text:"Single Room"},{icon:"pg-2-people",text:"Double Sharing"},{icon:"pg-3-people",text:"Triple Sharing"}],pgCommonAreas:[{icon:"pg-kitchen",text:"Kitchen"},{icon:"pg-sofa",text:"Living Room"},{icon:"pg-study-room",text:"Study Room"}],pgFacilities:[{icon:"pg-meals",text:"Meals Available"},{icon:"pg-cleaning",text:"Daily Cleaning"},{icon:"pg-supervisor",text:"Supervisor"},{icon:"pg-washing-machine",text:"Laundry Service"},{icon:"pg-wifi",text:"Wifi Connection"},{icon:"pg-guard",text:"Security Guard"}],mealTypes:[{icon:"pg-breakfast",text:"Breakfast"},{icon:"pg-lunch",text:"Lunch"},{icon:"pg-dinner",text:"Dinner"}],parkingType:[{icon:"pg-2-wheeler",text:"2 Wheeler"},{icon:"pg-4-wheeler",text:"4 Wheeler"}]},a={totalPriceInclude:["plc","parking","club-membership","idc","registration"]};return{get:function(e){return t[e]},getMasterList:function(e){return i[e]},getFieldList:function(e){return e?a[e]:[]},set:function(e,i){t[e]||(t[e]=[]),i&&-1==t[e].indexOf(i)&&t[e].push(i)},reset:function(e,i){if(t[e])for(var a=t[e].length-1;a>=0;a--)t[e][a]===i&&t[e].splice(a,1)},resetAll:function(e){t[e]&&(t[e]=[])}}}),Box.Application.getService("iconListService")}),define("modules/listProperty/scripts/services/completenessScoreService",["common/sharedConfig","modules/controls/scripts/controlsService","modules/iconList/scripts/iconListService","modules/listProperty/scripts/services/storageService"],function(e){return Box.Application.addService("completenessScoreService",function(){function t(){var t=i.get(e.TENANT_PREFERENCES.QUESTIONS_CACHE_KEY),a=0;return t&&t.length>0&&t.forEach(function(t){t.dependency&&i.get(e.TENANT_PREFERENCES.QUESTION_ID_PREFIX+"-"+t.dependency.parentQuestionId)!=t.dependency.dependencyAnswer||a++}),a}var i=Box.Application.getService("controlsService"),a=Box.Application.getService("iconListService"),o=Box.Application.getService("storageService");o.set("completenessScore",0);var n=i.NA.key,r=76,s=107,c=124,l=120,d="payingGuest",g="residential",p=["Description","Facing","area","availableFrom","balconies","bathroom","bed","bookingAmount","carpetArea","date","f-no","howMany","howMany2","kitchen","listingAddress","maintenanceCharges","mBathroom","mLiving","negotiable","openSide","ownershipType","price","propertyAge","propertyType","possession","rentPrice","roadWidth","roleOfUser","securityDeposit","status","total-f","sellType","hostelTotalRooms","vacantSingleRooms","vacantDoubleRooms","vacantTripleRooms","cuisineType","timingRestrictions","lastEntryTime","visitorRestrictions","singleSharingRent","singleSharingDeposit","doubleSharingRent","doubleSharingDeposit","tripleSharingRent","tripleSharingDeposit","laundryCharges","mealCharges","electricityCharges","otherCharges","noticePeriod","parkingAvailable","pgName","preferredTenant","workPreference","otherPreference"],m=function(e){var t={},i=!0,a=!1,o=void 0;try{for(var n,r=p[Symbol.iterator]();!(i=(n=r.next()).done);i=!0){var s=n.value;t[s+"ControlUpdated"]={id:s,handler:e,data:[s]}}}catch(c){a=!0,o=c}finally{try{!i&&r["return"]&&r["return"]()}finally{if(a)throw o}}return t},u={sell:{Description:8,Facing:2,area:4,availableFrom:4,balconies:2,bathroom:2,bed:4,bedroom:1,bookingAmount:1,carpetArea:1,date:4,"f-no":1,howMany:1,howMany2:1,kitchen:1,listingAddress:10,maintenanceCharges:2,mBalcony:1,mBathroom:1,mLiving:1,mBedroom:1,mOther:1,negotiable:1,openSide:1,ownershipType:1,price:6,propertyAge:1,propertyType:8,possession:1,rentPrice:6,roadWidth:2,securityDeposit:2,status:2,"total-f":1,sellType:2},rent:{Description:8,Facing:2,area:4,availableFrom:4,balconies:2,bathroom:2,bed:4,bedroom:1,bookingAmount:1,carpetArea:1,date:4,"f-no":1,howMany:1,howMany2:1,kitchen:1,listingAddress:10,maintenanceCharges:2,mapCoords:1,mBalcony:1,mBathroom:1,mBedroom:1,mLiving:1,mOther:1,negotiable:1,openSide:1,ownershipType:1,propertyType:8,price:6,propertyAge:1,possession:1,rentPrice:6,roadWidth:2,roleOfUser:1,securityDeposit:2,sellType:2,status:2,"total-f":1},payingGuest:{propertyType:8,Description:8,Facing:2,bed:4,"f-no":1,negotiable:1,"total-f":1,hostelTotalRooms:4,vacantSingleRooms:4,vacantDoubleRooms:4,vacantTripleRooms:4,cuisineType:1,timingRestrictions:2,lastEntryTime:2,visitorRestrictions:2,singleSharingRent:8,singleSharingDeposit:2,doubleSharingRent:8,doubleSharingDeposit:2,tripleSharingRent:8,tripleSharingDeposit:2,laundryCharges:1,mealCharges:1,electricityCharges:2,otherCharges:1,noticePeriod:2,parkingAvailable:2,pgName:1,preferredTenant:1,workPreference:1,otherPreference:1}},f=function(e){var t=e.id||e.key,i=0,o=a.get(t);if(!o)return i;switch(o=parseInt(o.length,10),o=e.oldVal||o,t){case"amenities":e.oldVal?i=e.oldVal>6?-6:-1*e.oldVal:o>6?i=0:0===o?i="set"===e.action?0:-1.5:1===o?i="set"===e.action?1.5:-1.5:2===o?i="set"===e.action?1.5:-1.5:3===o?i="set"===e.action?1.5:-1.5:4===o?i="set"===e.action?1.5:-1.5:5===o?i="set"===e.action?1.5:-1.5:6===o&&(i="set"===e.action?1.5:0);break;case"totalPriceInclude":case"overlooking":case"additionalRoom":case"furnishing":case"roomTypes":case"pgCommonAreas":case"pgFacilities":case"mealTypes":case"parkingType":e.oldVal?i=e.oldVal>0?-1:0:o>1?i=0:o>0?i="set"===e.action?1:0:0===o&&(i="set"===e.action?0:-1)}return i},v=function(e){var t=e.action,a=i.get("thumbCount"),o=0;switch(t){case"set":case"reset":a>8?o=0:0===a?o="set"===e.action?0:-12:1===a?o="set"===e.action?12:-5:2===a?o="set"===e.action?5:-3:3===a?o="set"===e.action?3:-2:4===a&&(o="set"===e.action?2:-2)}return o},h=function(e){var t=0;return!e.oldVal&&e.newVal&&e.newVal!=n?t=1:!e.newVal&&e.oldVal&&e.oldVal!=n&&(t=-1),t},y=function(){var e=i.get("propertyType");return e=e&&e.toLowerCase(),i.get("listingSubtype")==d?"studio"==e?l:c:"plot"==e?r:s},b=function(e){var a=0,o=y();return"rent"===i.get("SellRent")&&i.get("listingSubtype")==g&&(o+=t()),a=e/o*100,a=a.toFixed(0),a>100?100:a},S=function(e,t){var a=i.get("listingSubtype");if(!a&&"control"==e)return 0;var n=o.get("completenessScore")||0,r=i.get("SellRent"),s=void 0;switch(a==d&&(r=d),e){case"control":var c=void 0,l=u[r][t.data[0]];c=l?l:1,s=h(t)*c,n+=s;break;case"icon":r&&(s=f(t),n+=s);break;case"image":s=v(t),n+=s}return n=0>n?0:n,o.set("completenessScore",n),b(n)};return{getCompletenessScore:S,controlsListners:m}}),Box.Application.getService("completenessScoreService")}),define("services/deviceService",["services/utils","services/urlService","modules/gaTracking/scripts/services/gaTracking","services/localStorageService"],function(e,t,i,a){Box.Application.addService("DeviceService",function(t){function i(e){var t=document.documentElement,i=document.createElement("IFRAME");i.setAttribute("src",e),t.appendChild(i),i.parentNode.removeChild(i)}var a=(t.getGlobal("window"),t.getGlobal("location"),t.getGlobal("Jquery"),function(t,a){var r=o(t,a),s=e.getDeviceType();if("ios"===s||"android"===s||"windows"===s){var c="web2App://"+r;i(c),n(a)}}),o=function(e,t){return e+"/dataJson="+JSON.stringify(t)},n=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],i=e.cta,a=void 0===i?"":i;t.broadcast("webAppExist",{cta:a})};return{webToApp:a}})}),define("modules/listProperty/submodules/imageUpload",["doT!modules/listProperty/views/imageUpload","doT!modules/listProperty/views/imageThumb","doT!modules/imageProcessing/views/imageActions","services/utils","modules/controls/scripts/controlsService","modules/listProperty/scripts/services/notification","modules/listProperty/scripts/services/imageService","modules/gaTracking/scripts/services/gaTracking","modules/listProperty/scripts/services/completenessScoreService","services/deviceService"],function(e,t,i,a){Box.Application.addModule("imageUpload",function(o){function n(){o.broadcast("popup:close",{})}function r(){var e=w.get("thumbCount"),t=0,i=0;for(t=0;e>i;t++)T.find("#imageTag"+t)[0]&&(C.stopModule(T.find("#imageTag"+t)[0],"imageTag"+t),C.startAllModules(T.find("#imageTag"+t).parent()),i++);o.broadcast("removeAllTags")}function s(e){if("mobile"===R)return!1;for(var t=T.find(".image-container li.thumb"),i=(t.index(e),0);i<=t.length;i++){var a=t.eq(i).find('[data-type="inputBox"]').val();if(""==a||null==a){t.eq(i).find('input[data-type="inputBox"]').click();break}}}function c(e){var t=T.find(".image-container li.thumb.active");void 0==e||""==e?t.removeClass("tag"):t.addClass("tag"),s(t)}function l(e){var t=I(e).closest("li").data();t.tag=t.tag&&""!=t.tag?t.tag:"",o.broadcast("SetControlValue",{key:t.tag,val:t.tag,id:"imageTag"})}function d(e){return/^\d+$/.test(e)}function g(e){n(),"mobile"===w.get("device")&&o.broadcast("stopModule",{name:"imageUpload"}),setTimeout(function(){o.broadcast("moveListpropertyModule",{currentModule:"imageUpload",action:e,moduleMap:te})},700)}function p(e){var t="";for(var i in e){var a=e[i];if(a.data){H.push(a.data.id),q.push(a.data);var o=a.data.absolutePath;$.push(o),t="Success",z.push("Success");var n=parseInt(i,10);i!=w.get("defaultMediaId")&&n!==w.get("defaultMediaId")||n==a.data.id||w.set("defaultMediaId",a.data.id)}else a.error&&(Q.push(a.error.msg),t=a.error.msg,z.push(a.error.msg),D=!0)}return z.length===B&&X?(X=!1,m(),z=[]):M.find("span").eq(1).text("Uploading "+(z.length+1)+" image."),t}function m(){var e=w.get("imageIds");if(e=e?e.split(","):[],H=H.concat(e),H=a.uniqueItems(a.getIntegerArray(H)),q.length||U.length){var t=w.get("imageTypes");t&&(t=JSON.parse(t));var i=w.get("imagesData");if(i&&(i=JSON.parse(i)),t||i){var o=w.get("defaultMediaId"),n=w.get("deleteMediaIds");n=n?n.split(","):[];var r=w.get("mediaModifiedTypeMap");r=r?JSON.parse(r):{};for(var s=0;s<U.length;s++){if(0==U[s].upload&&0==U[s].dirty&&i[U[s].name]){r[i[U[s].name].id]=U[s].category;var c=parseInt(U[s].category,10);i[U[s].name].imageTypeId=c;var l=w.fieldsMap.imageTagsArray[c];i[U[s].name].imageType=l?l:"other"}0==U[s].upload&&1==U[s].dirty&&n.push(i[U[s].name].id),o==U[s].name&&w.set("defaultMediaId",i[U[s].name].id),i[U[s].name]&&(i[U[s].name].active=!0)}var d=w.get("inactiveImageIds");if(d=d?d.split(","):[],I.merge(n,d),w.set("inactiveImageIds",""),n.length>0){for(var g=0;g<n.length;g++)H=a.removeElement(H,n[g]);w.set("deleteMediaIds",a.uniqueItems(f(n)).join(","))}I.isEmptyObject(r)||w.set("mediaModifiedTypeMap",JSON.stringify(r))}else{var r=w.get("mediaModifiedTypeMap");r=r?JSON.parse(r):{};for(var s=0;s<U.length;s++)0==U[s].dirty&&(r[U[s].id]=U[s].category);I.isEmptyObject(r)||w.set("mediaModifiedTypeMap",JSON.stringify(r))}if(H=a.arrayDifference(a.uniqueItems(a.getIntegerArray(H)),f()),$=a.uniqueItems($),q=a.uniqueItems(q),w.set("imageData",q.join(",")),w.set("imageUrls",$.join(",")),w.set("imageIds",H.join(",")),B=0,q=[],H=[],$=[],M.addClass("hide"),D){var p=z.length-Q.length;p&&P.text(p+" image(s) uploaded successfully out of "+z.length),Q=[],z=[],T.find(".next-check").removeClass("disable"),T.find(".next-check").next().remove(),D=!1}else z.length&&T.find(".uploading_images").text(z.length+" image(s) uploaded successfully out of "+z.length),Q=[],z=[],u()}else w.set("deleteMediaIds",a.uniqueItems(f(H)).join(",")),w.set("imageIds",[].join(",")),M.addClass("hide"),B=0,T.find(".uploading_images").text("Image(s) uploaded successfully."),u()}function u(){w.get("isScreening")?Box.Application.broadcast("startCROApprove",{}):g("next")}function f(e){var e=e||[],t=w.get("deleteMediaIds");return t=t?t.split(","):[],e=e.concat(t),a.getIntegerArray(e)}function v(){T.find(".next-check").toggleClass("hide"),T.find("#imageTag").toggleClass("hidden")}function h(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e?(M.removeClass("hide"),T.find(".next-check").addClass("disable"),T.find(".next-check").after('<div class="loading_images">Loading listing images ...</div>')):(T.find(".next-check").removeClass("disable"),T.find(".next-check").next().remove(),M.addClass("hide"))}function y(){var e=T.find(".js-image-tag");e.length;e.each(function(){Box.Application.stop(this)})}function b(e){if(!L)return"";var t=T.find(".thumb"+e).data("title"),i=w.get("deleteMediaRejectionMap"),a=i&&i[t],o=w.fieldsMap.getField("imageRejectionReason",a);return o&&o.val}var S,x,I,T,C,k,_,P,M,w,A,R,j=[],B=0,U=[],D=!1,O=0,L=!1,N=!1,E=Box.Application.getService("ApiService"),F=Box.Application.getService("gaTracking"),J=Box.Application.getService("completenessScoreService"),V=Box.Application.getService("DeviceService"),W=Box.Application.getService("Utils"),G=!1,q=[],H=[],Q=[],z=[],$=[],K={},X=!0,Y=!1,Z=function(){var e="score",t=w.get("isScreening");return t&&(e=""),e},ee={addImages:{action:"add_images",category:"Listing_Upload",label:"add_images_form"},addImagesConfiguration:{action:"add_images",category:"Listing_Upload",label:"add_images_configuration"},deleteImage:{action:"delete_image",category:"Listing_Upload",label:"delete_image"},formSubmit:{action:"submit_with_image",category:"Listing_Upload",label:"submit_with_image"},displayImage:{action:"error_display_image",category:"Listing_Upload",label:"choose_display_image_error"},tagging:{action:"error_tag_images",category:"Listing_Upload",label:"tag_image_error"},imageMessage:{action:"image_error",category:"Listing_Upload",label:""},makeTitle:{action:"make_title_image",category:"Listing_Upload",label:"make_title_image"},cropImage:{action:"crop_image",category:"Listing_Upload",label:"crop_image"},rotateImage:{action:"rotate_image",category:"Listing_Upload",label:"rotate_image"},cropInitiate:{action:"crop_initiate",category:"Listing_Upload",label:"crop_initiate"},cropCancel:{action:"crop_cancel",category:"Listing_Upload",label:"crop_cancel"}},te={desktop:{prev:{start:"",stop:"imageUpload"},next:{start:Z,stop:""}},mobile:{prev:{start:"localityProject",stop:"imageUpload"},next:{start:"score",stop:"localityProject"}}},ie=function(e,t){var i={messageData:{name:e,loadId:t},message:"loadModule"};C.initializeCallbacks({data:i})},ae=function(t){var i=S.imageProcessingId;L="listingModalImage"!==S.imageProcessingId;var a=w.get("sellerId"),o=w.get("isScreening")?100:20,n=W.getDeviceType(),r=e({sellerId:a,maxImages:o,deviceType:n,parentId:x.id,moduleId:i});return r},oe=function(e,a,o){var n=b(e),r=t({inactiveMedia:L,index:e,src:a,rawsrc:o,isScreening:w.get("isScreening"),device:R,rejectionReason:n}),s=i({inactiveMedia:L,isScreening:w.get("isScreening")});return s+r},ne=function(e){var t=w.get("deleteMediaIds");t=t?t.split(","):[];var i=parseInt(e.id,10);if(i&&"number"==typeof i&&isFinite(i)&&Math.floor(i)===i){t.push(i),w.set("deleteMediaIds",a.uniqueItems(f(t)).join(",")),be(i);var o=w.get("imageIds");o=o?o.split(","):[],o=a.arrayDifference(a.uniqueItems(a.getIntegerArray(o)),f()),w.set("imageIds",o.join(","))}},re=function(e){var t=T.find("#"+e.id).closest(".thumb").data("title");if(d(t)){var i=parseInt(t,10),a=w.get("mediaModifiedTypeMap");a=a?JSON.parse(a):{},i&&"number"==typeof i&&isFinite(i)&&Math.floor(i)===i&&(a[i]=e.value,w.set("mediaModifiedTypeMap",JSON.stringify(a)))}},se=function(){0===H.length&&G===!1&&(T.find('.thumb:first input[data-type="make_title"]').click(),G=!0),Y||"mobile"===R||w.get("isScreening")?Y=!1:T.find('.thumb.active input[data-type="inputBox"]').click(),w.get("isScreening")&&L&&T.find(".plus-sign").addClass("hide"),G=!0},ce=function(e){switch(e){case"Please upload atleast one image":m();break;case"Please tag all the images.":F.track(ee.tagging),P.removeClass("hide").text(e);break;case"completed":se();break;default:(e.indexOf("Please upload image upto")>=0||e.indexOf("Please use a")>=0||e.indexOf("same image")>=0)&&setTimeout(function(){M.addClass("hide")},100),ee.imageMessage.label=e,F.track(ee.imageMessage),P.removeClass("hide").text(e.split(":")[0])}},le=function(e){var t=J.getCompletenessScore("image",{action:e});o.broadcast("show-completeness-score",{score:t})},de=function(e){T.find(".js-plus-thumb").hasClass("hide")?k.show("you have already added 20 images","",2500):(e.tag&&(w.set("setTag",e.tag),T.find('[data-type="image"]').removeAttr("multiple"),F.track(ee.addImagesConfiguration)),o.broadcast("load_image",{id:S.imageProcessingId}),V.webToApp("imagesCount",{count:w.get("thumbCount")||0}))},ge=function(e){var t=T.find(".thumb").length;!t&&S.canIgnoreImageCount!==!0||!w.get("defaultMediaId")&&w.get("imageIds")?t?(F.track(ee.displayImage),M.addClass("hide"),P.removeClass("hide").text("please select display image")):u():(F.track(ee.formSubmit),M.removeClass("hide"),D=!1,t>0?(X=!0,o.broadcast("form_submit",{id:S.imageProcessingId})):m())},pe=function(e){(/^imageTag[0-9]*$/.test(e.id)&&!L||/^inactiveImageTag[0-9]*$/.test(e.id)&&L)&&(e.value=w.get(e.id),void 0==e.value||""==e.value?(c(),o.broadcast("update_tag",{value:"",id:S.imageProcessingId})):(o.broadcast("update_tag",{value:e.value,id:S.imageProcessingId}),c(e.value)),re(e))},me=function(e){M.addClass("hide"),T.find(".uploading_images").remove(),T.find(".next-check").removeClass("disable"),T.find(".thumb").removeClass("blur").find(".type").text(""),ce(e.msg)},ue=function(e){if(e.images.length>0){B=z.length?z.length:0,U=e.images;for(var t=0;t<e.images.length;t++)e.images[t].dirty&&B++}},fe=function(e){if(e.image&&(e.image.datasrc||e.image.rawsrc)){var t;if(0===T.find(".thumb"+e.image.imageCount+" .image-action").length){var i=oe(e.image.imageCount,e.image.datasrc||e.image.rawsrc,e.image.rawsrc);T.find(".thumb"+e.image.imageCount).append(i),L?Box.Application.start(T.find("#inactiveImageTag"+e.image.imageCount)[0]):Box.Application.start(T.find("#imageTag"+e.image.imageCount)[0]),t=T.find(".thumb").length,w.set("thumbCount",t),le("set")}if(t=T.find(".thumb").length,t>0&&(1===t&&(G=!1),T.find(".js-plus-thumb label").text("add more")),w.get("setTag")&&!e.image.removed){if(delete e.image.id,e.image.dirty=!0,T.find(".thumb"+e.image.imageCount).addClass("js-pre-active-tag"),T.find(".thumb"+e.image.imageCount).data("title",e.image.name),T.find('[data-type="image"]').attr("multiple","multiple"),"mobile"===R){var a=I("#imageTag"+e.image.imageCount+' select option:contains("'+w.get("setTag")+'")').attr("value"),n=T.find("#imageTag"+e.image.imageCount+" select");n.val(a),n.trigger("change")}else T.find("#imageTag"+e.image.imageCount).find('li.js-selected:contains("'+w.get("setTag")+'")').click();Y=!0,o.broadcast("image-loaded",{tag:w.get("setTag"),src:e.image.datasrc,id:"propertyFloorPlans"}),w.reset("setTag")}}return e.image&&e.image.removed?(w.reset("setTag"),ne(e.image),Box.Application.stop(document.getElementById("imageTag"+e.image.imageCount)),T.find(".thumb"+e.image.imageCount).remove(),t=T.find(".thumb").length,0===t&&(T.find(".js-plus-thumb label").text("add images"),T.find(".js-plus-thumb").removeClass("hide")),w.get("deleting-selected-images")&&o.broadcast("selected-image-deleted",w.get("deleting-selected-images")),w.set("thumbCount",t),le("reset"),!1):void(O>0?(o.broadcast("SetControlValue",{key:K[e.image.name],val:K[e.image.name],id:L?"inactiveImageTag"+e.image.imageCount:"imageTag"+e.image.imageCount}),w.get("defaultMediaId")&&new RegExp(w.get("defaultMediaId")).test(e.image.title)&&T.find("#title-image"+e.image.imageCount).click(),delete K[e.image.name],O--,0===O&&h(O)):M.addClass("hide"))},ve=function(e){var t=e.xhr;if("clean"==t.data)p({});else if(200===t.status){var i=JSON.parse(t.response);i=i[0],d(e.imageId)&&ne({id:e.imageId});p(i)}else M.addClass("hide")},he=function(e){"imageUpload"==x.id?(H=w.get("imageIds")?w.get("imageIds").split(","):[],j=w.get("imageUrls")?w.get("imageUrls").split(","):[]):(H=w.get("inactiveImageIds")?w.get("inactiveImageIds").split(","):[],j=w.get("inactiveImageUrls")?w.get("inactiveImageUrls").split(","):[]),K=JSON.parse(w.get("imageTypes")),O!==H.length&&k.show("low quality images are removed","",2500),O=w.get("isScreening")?j.length:H.length,0===O&&h(O),setTimeout(function(){o.broadcast("set_title_image",{id:S.imageProcessingId,value:w.get("defaultMediaId")}),o.broadcast("set_default_image",{id:S.imageProcessingId,value:j})},1e3)},ye=function(e){w.set("deleting-selected-images",e),T.find("."+e.selector+' [data-type="remove_image"]').length>0?(T.find("."+e.selector).addClass("active"),T.find("."+e.selector+' [data-type="remove_image"]').click()):o.broadcast("selected-image-deleted",w.get("deleting-selected-images"))},be=function(e){
if(w.get("isScreening")){var t=w.get("deleteMediaRejectionMap")?w.get("deleteMediaRejectionMap"):{},i=w.get("imageRejectionReason");t[e]=i,w.set("deleteMediaRejectionMap",t)}},Se=function(){o.broadcast("startModule",{name:"imageRejectReason"}),o.broadcast("popup:open",{id:"imageRejectReason"})},xe=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],i=void 0;return e.length&&(i=e.length,h(i),e=e.map(function(e){return parseInt(e,10)}),A.loadImg(e,x.id,t)),i},Ie=function(e){var t=w.get("imageIds")?w.get("imageIds").split(","):[];t=a.getIntegerArray(t),t.indexOf(e)<0&&(t.push(e),w.set("imageIds",t.join(",")))},Te=function(e){var t=w.get("deleteMediaIds")?w.get("deleteMediaIds").split(","):[];t=a.getIntegerArray(t),t.splice(t.indexOf(e),1),w.set("deleteMediaIds",t.join(","))},Ce=function(e){var t=w.get("inactiveImageIds")?w.get("inactiveImageIds").split(","):[];t=a.getIntegerArray(t),t.splice(t.indexOf(e),1),w.set("inactiveImageIds",t.join(","));var i=w.get("deleteMediaRejectionMap");i&&delete i[e]},ke=function(e){I(e).closest(".thumb").find(".approved").removeClass("hide")},_e=function(e){var t=I(e).closest(".thumb");t.find(".js-reason").addClass("hide"),t.find(".image-title").removeClass("hide")},Pe=function(e){var t=parseInt(I(e).closest(".thumb").data("title"));Ie(t),Te(t),Ce(t),ke(e),_e(e)},Me=function(){var e=w.get("listingid"),t="/xhr/listingService/getVerifiedImages?listingId="+e;return E.get(t,"",!0)};return{init:function(){S=o.getConfig(),C=Box.Application.getService("CommonService"),x=o.getElement(),I=o.getGlobal("jQuery"),T=I(x),w=o.getService("controlsService"),A=o.getService("imageService"),k=o.getService("notificationService"),R=w.get("device"),N=w.get("isScreening"),I(x).append(ae(R)),te=te[R],ie("imageProcessing",S.imageProcessingId),w.set("imageUploadStartTime",Date.now()),o.broadcast("moduleLoaded",{name:"imageUpload",id:x.id}),M=I(".image-loading"),P=T.find(".error"),N&&L?(H=w.get("inactiveImageIds")?w.get("inactiveImageIds").split(","):[],j=w.get("inactiveImageUrls")?w.get("inactiveImageUrls").split(","):[],O=xe(H)):(j=w.get("imageUrls")?w.get("imageUrls").split(","):[],H=w.get("imageIds")?w.get("imageIds").split(","):[],q=w.get("imageData")?w.get("imageData").split(","):[],N?Me().then(function(e){O=xe(H,e)},function(){O=xe(H)}):O=xe(H)),A.getMasterImageRejectionReason()},destroy:function(){y(),Box.Application.stop(document.getElementById("listingModalImage")),T.html(""),S=null,x=null,I=null,T=null,P=null,M=null,w=null,k=null,_=null,j=null,q=[],U=[],H=[],Q=[],z=[],$=[]},onclick:function(e,t,i){switch(i){case"next":g("next");break;case"prev":g("prev");break;case"thumb_image":l(t);break;case"form_submit":F.track(ee.formSubmit),M.removeClass("hide"),D=!1,T.find(".next-check").addClass("disable"),T.find(".next-check").after('<div class="uploading_images">Uploading your images ...</div>'),X=!0,o.broadcast("form_submit",{});break;case"crop_image":M.removeClass("hide").delay(200).queue(function(e){I(this).addClass("hide"),e()}),v(),T.closest(".image-upload").removeClass("crop"),F.track(ee.cropImage);break;case"make_title":I(".image-title label").removeClass("selected"),I(".image-title input[type=radio]").prop("checked",!1),I(t).closest(".image-title").find("label").addClass("selected"),I(t).closest(".image-title input[type=radio").prop("checked",!0),G&&(P.addClass("hide"),F.track(ee.makeTitle));var a=I(t),n=a.closest(".thumb").data("title");w.set("defaultMediaId",n);break;case"rotate_cw":P.addClass("hide"),F.track(ee.rotateImage);break;case"crop_open":v(),P.addClass("hide"),T.closest(".image-upload").addClass("crop"),F.track(ee.cropInitiate);break;case"crop_close":v(),T.closest(".image-upload").removeClass("crop"),F.track(ee.cropCancel);break;case"load_image":P.addClass("hide"),w.reset("setTag"),T.find('[data-type="image"]').attr("multiple","multiple"),V.webToApp("imagesCount",{count:w.get("thumbCount")||0}),F.track(ee.addImages);break;case"remove_image_screening":var r=w.fieldsMap.imageRejectionReason;if(!r.length)return k.show("some error has occurred while deletion..please refresh your page","",2500);w.set("imageSelectedForDeletion",{element:t,moduleId:x.id}),P.addClass("hide"),Se();break;case"remove_image":P.addClass("hide"),F.track(ee.deleteImage);break;case"add_image":Pe(t)}},onchange:function(e,t,i){switch(i){case"image":t.value&&""!==t.value&&M.removeClass("hide")}},messages:["controlValueModified","images_submitted","un_load_module","image_updated","get_message","title_image","images_data","draw_images","image_submit","image_load","selected-image-changed","image-rejectReason-selected","reset_imageTags"],onmessage:function(e,t){switch(e){case"image_load":de(t);break;case"image_submit":ge(t);break;case"controlValueModified":pe(t);break;case"un_load_module":t.id===x.id&&g("prev",t);break;case"get_message":if(t.id!=S.imageProcessingId)return;me(t);break;case"images_data":if(t.id!=S.imageProcessingId)return;ue(t);break;case"image_updated":if(t.id!=S.imageProcessingId)return;fe(t);break;case"images_submitted":if(t.id!=S.imageProcessingId)return;ve(t);break;case"draw_images":if(t.id!=x.id)return;he(t);break;case"selected-image-changed":ye(t);break;case"image-rejectReason-selected":var i=w.get("imageSelectedForDeletion");if(x.id!=i.moduleId)return;o.broadcast("remove_image",{element:i.element,id:S.imageProcessingId});break;case"reset_imageTags":r()}}}})});