function _defineProperty(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}define("text!modules/imageProcessing/views/index.html",[],function(){return'<div class="module-content">\n    <form name="imageform" class="image-form" action="/uploadImage" method="post" enctype="multipart/form-data">\n        <div class="picedit_box_container col-sm-12 no-padding" data-module="image-processing">\n            <!-- begin_picedit_box -->\n            <div class="picedit_box initial_view  {{? !it.preview }} hide {{?}}">\n                <div class="pickedit_box_outer">\n                    <div class="pickedit-bg-container">\n                        <div class="pickedit_box_inner">\n                            <!-- Picedit canvas element -->\n                            <div class="picedit_canvas_box">\n                                <div class="picedit_canvas">\n                                    <canvas></canvas>\n                                </div>\n                            </div>\n                            <!-- Picedit draggable and resizeable div to outline cropping boundaries -->\n                            <div class="picedit_drag_resize">\n                                <div class="picedit_drag_resize_canvas"></div>\n                                <div class="picedit_drag_resize_box">\n                                    <div class="picedit_drag_resize_box_corner_wrap">\n                                        <div class="picedit_drag_resize_box_corner"></div>\n                                    </div>\n                                    <div class="picedit_drag_resize_box_elements">\n                                        <span class="picedit_control picedit_action ico-picedit-checkmark" data-action="crop_image"></span>\n                                        <span class="picedit_control picedit_action ico-picedit-close" data-action="crop_close"></span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <ul class="image-action crop-image-view" role="navigation">\n                            <li role="presentation">\n                                <button title="crop image" data-type="crop_close" type="button">cancel</button>\n                            </li>\n                            <li role="presentation">\n                                <a class="btnv2 btnv2-p" title="crop image" data-type="crop_image">done</a>\n                            </li>\n                        </ul>\n                        <span class="close-crop" data-type="crop_close"><i class="icon-close"></i></span>\n                    </div>\n                </div>\n                <div class="image-container">\n                    {{? (it.isScreening && (it.id != \'inactiveImageProcessing\'))}}\n                        <div data-type="show-approved" id="show-approved-btn" data-value="show" class="btn">Show Approved Images</div>\n                    {{?}}\n                    <div class="thumb-container">\n                        <ul class="thumb-list">\n                            <li class="plus-sign js-plus-thumb" data-type="load_image">\n                                <div class="plus-signn">\n                                    <i class="icon-add"></i>\n                                    <label>add image{{? it.maxImages > 1 }}s{{?}}</label>\n                                </div>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n\n                <div class="image-form-control">\n                </div>\n                <div class="image-submit"></div>\n            </div>\n            <div class="load-image {{? it.preview }} hide {{?}}">\n                <div class="btnv2 btnv2-s" data-type="load_image">choose image</div>\n            </div>\n        </div>\n    </form>\n</div>'}),define("modules/listProperty/scripts/services/getDataFromService",["services/apiService"],function(){return Box.Application.addService("getDataFromService",function(){function e(e){var i=a();if(i){for(var o in e)i[o]=e[o];t(i)}}var i=Box.Application.getService("ApiService"),t=function(e){"undefined"!=typeof Storage?sessionStorage.listingData=JSON.stringify(e):console.log("Sorry! No Web Storage support..")},a=function(){return"undefined"!=typeof Storage&&sessionStorage.listingData?JSON.parse(sessionStorage.listingData):{}},o=function(){sessionStorage.removeItem("listingData")},s=function(e,t){if(e){var s=function(e){return e},r=function(e){return console.log("error"),{}};return o(),i.get(t).then(s,r)}return a()};return{returnData:function(e,i){return s(e,i)},storeinStorage:function(e){return t(e)},storeData:e,removeFromStorage:o}}),Box.Application.getService("getDataFromService")}),define("modules/controls/scripts/controlsService",["modules/listProperty/scripts/services/getDataFromService","services/defaultService"],function(e,i){return Box.Application.addService("controlsService",function(e){function t(e,i){var t=[];e:for(var a=0;a<e.length;a++){for(var o=0;o<i.length;o++)if(e[a].key===i[o].key)continue e;t.push(e[a])}return t}var a,o=Box.Application.getService("getDataFromService"),s={},r="-promise";s.listeners={};var n=["Vitrified Tiles","Ceramic Porcelain Tiles","Anti Skid Tiles","Marble Granite Tiles","Wooden flooring","RAK/laminated wooden flooring","Wood Finish Vinyl Flooring"],d=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],l=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],c=[{key:1,val:"",display:1},{key:2,val:"",display:2},{key:3,val:"",display:3},{key:4,val:"",display:4},{key:5,val:"",display:5},{key:6,val:"",display:6},{key:7,val:"",display:7},{key:8,val:"",display:8},{key:9,val:"",display:9},{key:10,val:"",display:10},{key:11,val:"",display:11},{key:12,val:"",display:12},{key:13,val:"",display:13},{key:14,val:"",display:14},{key:15,val:"",display:15}],p=[{key:"1 rk",val:"",display:"1 RK"}],h=[{key:"Apartment",val:"Apartment",display:"Apartment",priority:1,icon:"apartment"},{key:"BuilderFloor",val:"builder/independent floor",display:"independent / builder floor",priority:2,icon:"independent-floor"},{key:"Villa",val:"Villa",display:"Villa",priority:3,icon:"villa"},{key:"IndependentHouse",val:"Independent House",display:"Independent House",priority:4,icon:"independent-house"},{key:"Penthouse",val:"Penthouse",display:"Penthouse",priority:5,icon:"penthouse"},{key:"Studio",val:"Studio",display:"Studio",priority:6,icon:"studio"},{key:"Plot",val:"Plot",display:"Plot",priority:7,icon:"land"}],m=[{key:"Shop",val:"Shop",display:"Shop",priority:8,icon:"shop"},{key:"Office",val:"Office",display:"Office",priority:9,icon:"office"}],g=[{key:"Apartment",val:"Apartment",display:"Apartment",priority:1,icon:"apartment"},{key:"BuilderFloor",val:"builder/independent floor",display:"independent / builder floor",priority:2,icon:"independent-floor"},{key:"Hostel",val:"Hostel",display:"Hostel",priority:3,icon:"pg-hostel"},{key:"Villa",val:"Villa",display:"Villa",priority:4,icon:"villa"},{key:"IndependentHouse",val:"Independent House",display:"Independent House",priority:5,icon:"independent-house"},{key:"Penthouse",val:"Penthouse",display:"Penthouse",priority:6,icon:"penthouse"},{key:"Studio",val:"Studio",display:"Studio",priority:7,icon:"studio"}],u={key:"n/a",val:"na (for plots only)"},_=[],v={sellType:function(e){switch(e){case"true":case"Primary":return"Primary";case"Resale":case"false":return"Resale"}},status:function(e){switch(e){case"readyToMoveIn":case"Completed":case"Ready To Move In":return"readyToMoveIn";case"Under Construction":return"underConstruction";case"n/a":case u.key:return"n/a";default:return"underConstruction"}},getMapVal:function(e,i){return this[e]?this[e](i):i}},f=(a={sellType:[{key:"Primary",val:"New"},{key:"Resale",val:"Resale"}],"city-lead-price":[]},_defineProperty(a,"country-homeloan"+r,i.getCountries()),_defineProperty(a,"country-homeloan",[]),_defineProperty(a,"cities"+r,i.getCities(!0)),_defineProperty(a,"cities",[]),_defineProperty(a,"branch",[{key:"Ahmedabad",val:"Ahmedabad"},{key:"Odhav",val:"Odhav"}]),_defineProperty(a,"propertyFloorPlans",[]),_defineProperty(a,"propertyType",h),_defineProperty(a,"commercialPropertyType",m),_defineProperty(a,"pgPropertyTypes",g),_defineProperty(a,"sqft"+r,i.getUnitTypes("sqft")),_defineProperty(a,"sqft",[]),_defineProperty(a,"plotSqft"+r,i.getUnitTypes("plotSqft")),_defineProperty(a,"plotSqft",[]),_defineProperty(a,"status",[{key:"readyToMoveIn",val:"Ready To Move In"},{key:"underConstruction",val:"Under Construction"}]),_defineProperty(a,"bed",c),_defineProperty(a,"studioBed",p),_defineProperty(a,"pgBed",c.slice(1)),_defineProperty(a,"Ac",d),_defineProperty(a,"TV",d),_defineProperty(a,"Wardrobe",d),_defineProperty(a,"bedroom",d),_defineProperty(a,"bathroom",l),_defineProperty(a,"balconies",l),_defineProperty(a,"howMany",d),_defineProperty(a,"howMany2",d),_defineProperty(a,"f-no",["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"]),_defineProperty(a,"total-f",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"]),_defineProperty(a,"openSide",["1","2","3","4"]),_defineProperty(a,"Facing",["North","South","West","East","NorthEast","NorthWest","SouthEast","SouthWest"]),_defineProperty(a,"ft",["feet","meters"]),_defineProperty(a,"propertyAge",["Less than 1 year","1 year","2 years","3 years","4 years","5 years","6 years","7 years","8 years","9 years","10 years","11 years","12 years","13 years","14 years","15 years","16 years","17 years","18 years","19 years","20 years","21 years","22 years","23 years","24 years","25 years","26 years","27 years","28 years","29 years","30 years","31 years","32 years","33 years","34 years","35 years","36 years","37 years","38 years","39 years","40 years","41 years","42 years","43 years","44 years","45 years","46 years","47 years","48 years","49 years","50 years"]),_defineProperty(a,"ownershipType",["Freehold","Power of Attorney","Leasehold","Co-Operative Society"]),_defineProperty(a,"mLiving",n),_defineProperty(a,"kitchen",n),_defineProperty(a,"mBedroom",n),_defineProperty(a,"mBathroom",n),_defineProperty(a,"mBalcony",n),_defineProperty(a,"mOther",n),_defineProperty(a,"imageTagsArray",_),_defineProperty(a,"imageTag",[]),_defineProperty(a,"rejectReason",[{key:"Duplicate listings",val:"Duplicate listings"},{key:"Once duplicate listing will not go live",val:"Once duplicate listing will not go live"},{key:"Area issue",val:"Area issue"},{key:"Price issue",val:"Price issue"},{key:"Commercial, PG, Farmhouse, Agricultural land",val:"Commercial, PG, Farmhouse, Agricultural land"},{key:"Bed/Bath room mismatch",val:"Bed/Bath room mismatch"},{key:"Customer escalation",val:"Customer escalation"},{key:"Property not available",val:"Property not available"},{key:"Developer has raised issue",val:"Developer has raised issue"},{key:"Area, Price not available in project",val:"Area, Price not available in project"},{key:"Description not relevant to listing posted",val:"Description not relevant to listing posted"},{key:"Property Type seems to be incorrect",val:"Property Type seems to be incorrect"},{key:"Locality appears to be incorrect",val:"Locality appears to be incorrect"},{key:"other",val:"Other"}]),_defineProperty(a,"masterFlooringId",[{key:1,value:"Vitrified Tiles"},{key:2,value:"Ceramic Porcelain Tiles"},{key:3,value:"Anti Skid Tiles"},{key:4,value:"Marble Granite Tiles"},{key:5,value:"Wooden flooring"},{key:6,value:"RAK/laminated wooden flooring"},{key:10,value:"Wood Finish Vinyl Flooring"}]),_defineProperty(a,"flooringAreaId",[{key:6,value:"mBalcony"},{key:7,value:"kitchen"},{key:8,value:"mLiving"},{key:9,value:"mBedroom"},{key:10,value:"mOther"},{key:11,value:"mBathroom"}]),_defineProperty(a,"additionalRoomMap",{storeRoom:"store-room",studyRoom:"study-room",poojaRoom:"prayer",servantRoom:"servant-room"}),_defineProperty(a,"imageRejectionReason",[]),_defineProperty(a,"stateList"+r,i.getStateList()),_defineProperty(a,"stateList",[]),_defineProperty(a,"hostelTotalRooms",["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"]),_defineProperty(a,"mapKeyFromMasterList",function(e,i){var t={}.toString.call(i);switch(t){case"[object String]":case"[object Number]":return this.getArrField(e,i);case"[object Object]":return this.getArrField(e,i.key);case"[object Array]":for(var a=[],o=0;o<i.length;o++){var s=this.getObjField(e,i[o]);a.push(s)}return a}}),_defineProperty(a,"findFirst",function(e,i){if(!i&&!e)return null;if(!i)return{};for(var t=0;t<e.length;t++)if(e[t].key==i)return e[t];return{key:i,val:i}}),_defineProperty(a,"getField",function(e,i){return this.findFirst(this[e],i)}),_defineProperty(a,"getObjField",function(e,i,t){var a=t?t:e,o=v.getMapVal(a,i);return this.getField(a,o)}),_defineProperty(a,"getArrField",function(e,i){var t=this.getObjField(e,i),a=[];return a.push(t),a}),_defineProperty(a,"listingSubtype",[{key:"residential",val:"Residential"},{key:"commercial",val:"Commercial"},{key:"payingGuest",val:"Paying Guest"}]),_defineProperty(a,"currentlyLeasedOut",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"assuredReturn",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"pantryType",[{key:"DRY",val:"Dry"},{key:"WET",val:"Wet"},{key:"NOT_AVAILABLE",val:"Not Available"}]),_defineProperty(a,"noOfPersonalWashrooms",["1","2","3","4","5","6","7","8","9","10"]),_defineProperty(a,"noOfSharedWashrooms",["1","2","3","4","5","6","7","8","9","10"]),_defineProperty(a,"willingToModifyInteriors",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"propertyAgeCommercial",["Less than 1 year","1 year","2 years","3 years","4 years","5 years","6 years","7 years","8 years","9 years","10 years","11 years","12 years","13 years","14 years","15 years","16 years","17 years","18 years","19 years","20 years","21 years","22 years","23 years","24 years","25 years","26 years","27 years","28 years","29 years","30 years","31 years","32 years","33 years","34 years","35 years","36 years","37 years","38 years","39 years","40 years","41 years","42 years","43 years","44 years","45 years","46 years","47 years","48 years","49 years","50 years"]),_defineProperty(a,"isMainRoadFacing",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"isCornerShop",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"isBoundryWallPresent",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"noOfLifts",["1","2","3","4","5","6","7","8","9","10"]),_defineProperty(a,"propertySuitableFor",[{key:"HOSPITAL",val:"Hospital"},{key:"IT_OFFICE",val:"IT Office"},{key:"BPO",val:"Call Center/BPO"},{key:"RETAIL_OUTLET",val:"Retail Outlet"},{key:"RESTAURANT",val:"Restaurant"},{key:"PRIVATE_OFFICE",val:"Private Office"},{key:"OTHERS",val:"Others"}]),_defineProperty(a,"cuisineType",[{key:"1",val:"Vegeterian"},{key:"2",val:"Non- Vegeterian"},{key:"3",val:"South Indian"},{key:"4",val:"North Indian"},{key:"5",val:"Jain Food"}]),_defineProperty(a,"timingRestrictions",[{key:"yes",val:"Yes"},{key:"no",val:"No"}]),_defineProperty(a,"visitorRestrictions",[{key:"Visitors Allowed",val:"Visitors Allowed"},{key:"Visitors Not Allowed",val:"Visitors Not Allowed"},{key:"No Overnight Stay",val:"No Overnight Stay"}]),_defineProperty(a,"noticePeriod",[{key:"15 days",val:"15 days"},{key:"1 month",val:"1 month"},{key:"2 months",val:"2 months"}]),_defineProperty(a,"parkingAvailable",[{key:"no",val:"No"},{key:"yes",val:"Yes"}]),_defineProperty(a,"lastEntryTime",[{key:"00:00:00",val:"12:00 am"},{key:"23:30:00",val:"11:30 pm"},{key:"23:00:00",val:"11:00 pm"},{key:"22:30:00",val:"10:30 pm"},{key:"22:00:00",val:"10:00 pm"}]),_defineProperty(a,"preferredTenant",[{key:"Male",val:"Male"},{key:"Female",val:"Female"},{key:"Both",val:"Both"}]),_defineProperty(a,"workPreference",[{key:"Student",val:"Student"},{key:"Salaried",val:"Salaried"},{key:"Businessmen",val:"Businessmen"},{key:"No Preference",val:"All"}]),_defineProperty(a,"otherPreference",[{key:"Only Vegetarians",val:"Only Vegetarians"},{key:"Alcohol Not Allowed",val:"Alcohol Not Allowed"},{key:"Pets Allowed",val:"Pets Allowed"}]),a),y=function(e){var i=[],t={}.toString;if(!e)return i;var a=t.call(e[0]);if("[object Object]"==a)return e;for(var o=0;o<e.length;o++){var a=t.call(e[o]),s={};switch(a){case"[object Array]":s.key=e[o][0],s.val=e[o][1];break;case"[object Object]":s=e[o];break;case"[object String]":case"[object Number]":s.key=e[o],s.val=e[o];break;default:s.key=u.key,s.val=u.val}i.push(s)}return i};return{get:function(e){return s[e]},getAll:function(){return s},set:function(e,i){var t=s[e];if(i||0==i?s[e]=i:this.reset(e,i),s.listeners[e])for(var a=0;a<s.listeners[e].length;a++){var r={};r.data=s.listeners[e][a].data,r.id=e,r.oldVal=t,r.newVal=i,s.listeners[e][a].callBack(r)}var n={};n[e]=i,t!=i&&o.storeData(n)},reset:function(e,i){delete s[e]},resetAll:function(){s={}},getMasterList:function(e){return y(f[e])},getRestrictedList:function(e,i){var a=y(f[e]),o=t(a,i);return o},convertKeyValues:function(e){return y(e)},getDynamicMasterList:function(e){return f[e+r].then(function(i){return f[e]=i,i})},addListener:function(e){var i;s.listeners[e.id]?i=s.listeners[e.id]:(s.listeners[e.id]=[],i=s.listeners[e.id]),i.push({callBack:e.handler,data:e.data})},removeListener:function(e){var i=s.listeners[e.id];i&&(s.listeners[e.id]=i.filter(function(i){return!(i.callBack===e.handler||i.data===e.data||i.callBack&&e.handler&&i.callBack.toString()===e.handler.toString()||i.data&&e.data&&i.data.toString()===e.data.toString())}))},fieldsMap:f,NA:u}}),Box.Application.getService("controlsService")}),function(e,i,t,a){"use strict";function o(i,t){this.inputelement=i,this.element=i,this.imageCount=0,this.options=e.extend({},r,t),this.options.isSafari=/safari/i.test(navigator.userAgent)&&!/chrome/i.test(navigator.userAgent),this.options.imageRatio=this.options.imageRatio.split(":"),this.options.imageRatio.length&&(this.options.imageRatioWidth=parseInt(this.options.imageRatio[0],10),this.options.imageRatioHeight=parseInt(this.options.imageRatio[1],10),this.options.imageRatioWidth=isNaN(this.options.imageRatioWidth)?4:this.options.imageRatioWidth,this.options.imageRatioHeight=isNaN(this.options.imageRatioHeight)?3:this.options.imageRatioHeight),this.$element=e(this.element),this._defaults=r,this._name=s,this._image=!1,this.cropOpen=!1,this.isIOS=e("html").hasClass("ios"),this._images=[],this._active=-1,this._loadFailed=0,this._filename="",this._variables={},this.init()}var s="picEdit",r={imageUpdated:function(e){},formSubmitted:function(e,i){},redirectUrl:!1,maxWidth:600,maxHeight:450,resizeMaxWidth:1200,resizeMaxHeight:800,resizeThumbMaxWidth:400,resizeThumbMaxHeight:300,imgMinWidth:600,imgMinHeight:450,aspectRatio:!0,defaultImage:!1,maxImages:50,minWidth:100,minHeight:75,imageRatio:"4:3",inputName:"image",objectType:"listing",objectId:"",addWaterMark:!0,start:function(e){},getMessage:function(e){}};o.prototype={init:function(){function a(e){if(e||e.length){o._loadFailed=0;var i=0,a=e.length,s=a;for(o.upload=!0,i=0;a>i;i++)!function(e){var i=o.iOSRenamneFile(e.name),r=e.size,n=Math.ceil(r/1e3),d=Math.ceil(n/1e3);return d>5?o.options.compress=3/d:n>1e3?o.options.compress=1e3/n:n>300?o.options.compress=150/n:o.options.compress=-1,e.size>o.options.maxSize?(o.set_messagebox(o.messageText.too_large),o._loadFailed++,void s--):(o._filename||(o._filename=i),-1===o.options.allowedTypes.indexOf(e.type)?(o.set_messagebox(o.messageText.invalid_type),o._loadFailed++,void s--):o.checkDuplicate(i)?(o.set_messagebox(o.messageText.duplicate_image),o._loadFailed++,void s--):void function(i){var r=new FileReader;r.onload=function(r){var n=t.createElement("img");n.onerror=function(e){o.set_messagebox(o.messageText.invalid_image),o._loadFailed++,s--},n.onload=function(){var d=t.createElement("canvas"),l=d.getContext("2d"),c=o.options.resizeMaxWidth,p=o.options.resizeMaxHeight,h=n.width,m=n.height;h>m?h>c&&(m*=c/h,h=c):m>p&&(h*=p/m,m=p),d.width=Math.ceil(h),d.height=Math.ceil(m),l.drawImage(n,0,0,h,m);var g="";if(i&&i>0){var u=.4>i?.4:i;g=d.toDataURL(e.type,u)}else g=r.target.result;o._create_image_with_datasrc(g,function(){o._thumbActive(),o.options.imageUpdated(o._images[o.active]),s--,o.lastFile=0===s?!0:!1,o.lastFile&&o.lastFileCleanupTask(a)},e,!1)},n.src=r.target.result},r.readAsDataURL(e)}(o.options.compress))}(e[i]);o.options.preview===!0&&setTimeout(function(){o._images.length&&o.$element.addClass("preview")},100)}}var o=this;this._parent=e(this.element).closest(".picedit_box_container"),this._image_container=this._parent.find(".image-container")[0],this.$image_container=e(this._image_container),this.$thumb_container=e(this._parent.find(".thumb-list")[0]);var s=e(this.inputelement).prop("type");if("file"==s)this._fileinput=e(this.inputelement);else{var r=this.options.multi?'multiple="multiple"':"";e(this.inputelement).after('<input type="file" data-type="'+this.options.inputName+'" name="'+this.options.inputName+'" style="display:none" '+r+' accept="'+this.options.allowedTypes.join(", ")+'">'),this._fileinput=e(this.inputelement).next("input")}if(!this.check_browser_capabilities())return"file"!=s&&(e(this.inputelement).prop("type","file"),e(this._fileinput).remove()),e(this.inputelement).show(),void e(this.element).remove();if(this._canvas=e(this.element).find(".picedit_canvas > canvas")[0],this._ctx=this._canvas.getContext("2d"),this._viewport={width:0,height:0},this._cropping={is_dragging:!1,is_resizing:!1,left:0,top:0,width:0,height:0,cropbox:e(this.element).find(".picedit_drag_resize"),cropframe:e(this.element).find(".picedit_drag_resize_box"),dragger:e(this.element).find(".picedit_drag_resize_box_corner_wrap")},this.messageText={invalid_type:"Please use a "+this.options.allowedTypes.join(" or ").replace(/image\//g,"")+" image type",too_large:"Please upload image upto "+this.options.maxSize/1e6+" MB",delete_image:"Are you sure to delete given image?",crop_confirm:"Are you sure to crop image?",no_image:"Please upload atleast one image",no_dirty_image:"Please modify some image.",not_in_ration:"Given image is not in required ration, pleae crop it.",not_tagged:"Please tag all the images.",wait:"Please wait ...",working:"Working ...",webrtc:"Sorry, your browser doesn't support WebRTC!",video_error:"No video source detected! Please allow camera access!",get_an_image:"Open an image or use your camera to make a photo!",formapi_error:"Sorry, the FormData API is not supported!",server_error:"Some error occured, please retry after some time!",form_sucess:"Data successfully submitted!",title_image:"choose a display image",duplicate_image:"The same image cannot be added more than once",invalid_image:"Please upload a valid image",min_size:"please upload higher quality images (minimum resolution of "+o.options.imgMinWidth.toString()+" * "+o.options.imgMinHeight.toString()+").",max_images:"You can upload only "+this.options.maxImages+" images at max.",error:{msg:"Error message."}},this.dragoffset={left:0,top:0},this.upload=!1,this.lastFile=!1,e(this._fileinput).on("change",function(){a(this.files)}),!i.Clipboard){var n=e(t.createElement("div"));n.prop("contenteditable","true").css({position:"absolute",left:-999,width:0,height:0,overflow:"hidden",outline:0,opacity:0}),e(t.body).prepend(n)}this._theformdata=!1,this._theform=e(this.inputelement).parents("form"),this._theform.length&&this._theform.on("submit",function(){return o._formsubmit()}),this._bindSelectionDrag(),this._bindImage(),this.options.defaultImage&&o.set_default_image(this.options.defaultImage),this.options.start(this),this.options.preview===!1&&this.$element.addClass("no-preview")},iOSRenamneFile:function(i){return e(".ios.mobile-safari, .ios.mobile").length>0?(new Date).getTime()+"."+i.split(".")[1]:i},checkDuplicate:function(e){var i=this,t=i._images.filter(function(i){return i.name==e});return t.length>0?!0:!1},lastFileCleanupTask:function(i){var t=this;t._loadFailed&&i>1&&t.set_messagebox("Failed to load "+t._loadFailed+" out of "+i+" images because of improper size/dimensions/duplicate copy"),t.set_messagebox("completed"),t.options.deviceType=a,e(t._fileinput).val(null),t.upload=!1,t.lastFile=!1,t._loadFailed=0},form_submit:function(){return this._formsubmit()},reset:function(){1===this.options.maxImages&&(e(this._fileinput).val(null),this._images=[],this._image=null)},check_browser_capabilities:function(){return 0==!!i.CanvasRenderingContext2D?!1:i.FileReader?!0:!1},getDataUri:function(e,i,a){var o=new Image,s=this;s.options.isSafari||o.setAttribute("crossOrigin","anonymous"),o.onload=function(){var e=t.createElement("canvas"),r=e.getContext("2d"),n=s.options.resizeMaxWidth,d=s.options.resizeMaxHeight,l=o.width,c=o.height;l>c?l>n&&(c*=n/l,l=n):c>d&&(l*=d/c,c=d),e.width=Math.ceil(l),e.height=Math.ceil(c),r.drawImage(o,0,0,l,c),a(e.toDataURL(i||"image/jpeg"))},o.src=e},set_default_image:function(e){if("object"==typeof e&&e instanceof Array){var i=e.length,t=0,a=this,o=i;for(t=0;i>t;t++)this.upload=!0,function(e){a._create_image_with_datasrc(e,function(){a._thumbActive(),a.options.imageUpdated(a._images[a.active]),o--,a.lastFile=0===o?!0:!1,a.lastFile&&a.lastFileCleanupTask(i)},!1,!0,!1)}(e[t])}},set_loading:function(i){return e(".alpha_dummy_test").addClass("hide")},set_messagebox:function(e,i,t){return this.options.getMessage(e)},_max_images:function(){return this.options.maxImages<=this._images.length?(this.set_messagebox(this.messageText.max_images),!1):!0},load_image:function(){this._fileinput.click()},rotate_cw:function(){if(!this._image)return!1;var e=this;if(this._images[this.active].datasrc)this.set_loading(1).delay(200).promise().done(function(){e._doRotation(90),e._resizeViewport()});else{var e=this;this.getDataUri(this._images[this.active].rawsrc,this._images[e.active].type,function(i){e.set_loading(1).delay(200).promise().done(function(){e._doRotation(90),e._resizeViewport()})})}},resize_image:function(){if(!this._image)return!1;var e=this;this.set_loading(1).delay(200).promise().done(function(){var i=t.createElement("canvas"),a=i.getContext("2d");i.width=e._variables.resize_width,i.height=e._variables.resize_height,a.drawImage(e._image,0,0,i.width,i.height),e._create_image_with_datasrc(i.toDataURL(),function(){e._updateThumb()})})},crop_image:function(){var e=this._calculateCropWindow(),i=this;this.set_loading(1).delay(200).promise().done(function(){var a=t.createElement("canvas"),o=a.getContext("2d");a.width=e.width,a.height=e.width*i.options.imageRatioHeight/i.options.imageRatioWidth,o.drawImage(i._image,e.left,e.top,e.width,e.height,0,0,e.width,e.height),i._create_image_with_datasrc(a.toDataURL(i._images[i.active].type,i.options.quality),function(){i._images[i.active].dirty=!0,i._images[i.active].modified=!0,i._updateThumb()})}),this.crop_close()},crop_frame_creation:function(){var i=this;if(!i._cropping.cropbox.hasClass("active")){i._cropping.cropbox.addClass("active"),i.$element.removeClass("initial_view"),i.$element.addClass("crop"),i.cropOpen=!0,i._resizeViewport();var t=i._cropping.cropframe[0],a={},o=e(i._canvas);if(a.width=o.width(),a.height=o.height(),i.options.fullCrop===!0){a.width=a.width>i.options.maxWidth?i.options.maxWidth:a.width,a.height=a.height>i.options.maxHeight?i.options.maxHeight:a.height;var s=parseFloat(a.width/i.options.imageRatioWidth*i.options.imageRatioHeight).toFixed(2);s>a.height?a.width=parseFloat(a.height*i.options.imageRatioWidth/i.options.imageRatioHeight).toFixed(2):a.height=s,i._cropping.cropframe.css({top:0,left:0}),i.width=a.width,i.height=a.height}else a.width=parseFloat(40*a.width/100).toFixed(2),a.height=parseFloat(a.width/i.options.imageRatioWidth*i.options.imageRatioHeight).toFixed(2);i._set_width(t,a.width,a.height)}},crop_open:function(){var e=this;return e._image?void(e._images[e.active].datasrc?e.crop_frame_creation():e.getDataUri(e._images[e.active].rawsrc,e._images[e.active].type,function(i){e._images[e.active].datasrc=i,e.crop_frame_creation()})):!1},crop_close:function(){this._cropping.cropbox.removeClass("active"),this.$element.addClass("initial_view"),this.$element.removeClass("crop"),this.cropOpen=!1,this.$element.addClass("initial_view");var e=this._cropping.cropframe[0];e.removeAttribute("style")},preview_open:function(){this.$element.addClass("preview"),this.options.preview=!0,this._resizeViewport()},preview_close:function(){this.$element.removeClass("preview"),this.options.preview=!1,this._resizeViewport()},action_open:function(){this.$element.removeClass("preview").addClass("action")},action_close:function(){this.$element.removeClass("action").addClass("preview")},confirm:function(e){function i(i){return e.apply(this,arguments)}return i.toString=function(){return e.toString()},i}(function(e){return confirm(e)}),_post_image_creation_with_datasrc:function(i,o,s,r,n,d,l,c){var p=this,h=p.$thumb_container;if(p._image=o,p.upload===!0||"android"==p.options.deviceType){if(p._max_images()===!1)return void(d&&"function"==typeof d&&d());var m=s?p.iOSRenamneFile(s.name):r,g=s?s.type:"image/jpeg",u=0==n?!1:!0,_=m;u||(_=parseInt(m.split(".")[0]));var v=a,f=e(t).find("#js-images-count").data("verifiedImagesIdArray");v=f&&f.find(function(e){return parseInt(e)===_})?'<li class="thumb thumb'+p.imageCount+' verifiedImage hide" data-title="'+_+'"><div class="approved"><span>Approved</span></div>':'<li class="thumb thumb'+p.imageCount+'" data-title="'+_+'">';var y=i||l+"?width="+p.options.resizeThumbMaxWidth+"&height="+p.options.resizeThumbMaxHeight;v+='<div class="thmb-photo-wrap"><img data-type="thumb_image" src="'+y+'" alt="Remove image"/></div>',v+="</li>",h.find(".js-plus-thumb").before(v),p._images.push({datasrc:i,rawsrc:l+"?width="+p.options.resizeMaxWidth+"&height="+p.options.resizeMaxHeight,category:"",name:m,title:m,dirty:u,upload:n,type:g,id:_,imageCount:p.imageCount}),p.active=p._images.length-1,p.imageCount++}else p._images[p.active].datasrc=i;p.options.preview===!0&&p.$element.addClass("preview"),d&&"function"==typeof d&&d()},_create_image_with_datasrc:function(e,i,a,o,s){if(!e)return!1;var r=this,n=(r.$thumb_container,t.createElement("img"));o&&!r.options.isSafari&&n.setAttribute("crossOrigin","anonymous"),a&&(n.file=a),n.src=e,null==e?(r._image=n,r._paintCanvas(),r.$element.addClass("no_image")):r.$element.removeClass("no_image");var d,l=e?e.replace(/^.*[\\\/]/,""):"image";n.onload=function(){return n.width<r.options.imgMinWidth||n.height<r.options.imgMinHeight?(r.set_messagebox(r.messageText.min_size),r._loadFailed++,void(i&&"function"==typeof i&&i())):void(o?(o=!1,d=e,r._post_image_creation_with_datasrc("",n,a,l,s,i,d,!0)):r._post_image_creation_with_datasrc(e,n,a,l,s,i,d,o))}},_bindSelectionDrag:function(){var t=this,a=this._cropping.cropframe,o=this._cropping.cropbox.find(".picedit_drag_resize_box_corner_wrap"),s=this.$element.find(".pickedit_box_inner");
e(i).on("mousedown touchstart",function(e){var i=e.clientX?e:e.originalEvent.touches[0];t._cropping.x=i.clientX,t._cropping.y=i.clientY,t._cropping.w=a[0].clientWidth,t._cropping.h=a[0].clientHeight,t.upload=!1,a.on("mousedown touchstart",function(e){e.target==this&&(e.preventDefault(),i=e.pageX?e:e.originalEvent.touches[0],t._cropping.is_dragging=!0,t.mouseX=i.PageX,t.mouseY=i.PageY)}),a.on("mousemove touchmove",function(e){e.stopPropagation(),e.preventDefault(),t._cropping.is_dragging&&t._selection_drag_movement(e),t._cropping.is_resizing===!0&&t._selection_resize_movement(e)}),s.on("mousemove touchmove",function(e){e.stopPropagation(),e.preventDefault(),t._cropping.is_resizing===!0&&t._selection_resize_movement(e)}),o.on("mousemove touchmove",function(e){e.stopPropagation(),e.preventDefault(),t._cropping.is_resizing=!0,t._selection_resize_movement(e)})}).on("mouseup touchend",function(){t._cropping.is_dragging=!1,t._cropping.is_resizing=!1,t._variables.prev_pos=!1,a.off("mousemove touchmove"),o.off("mousemove touchmove")})},_in_parent:function(){var i=e(this.inputelement).find(".picedit_drag_resize_box_corner_wrap"),t=i.offsetParent().offsetParent(),a=i.offset().left,o=i.offset().top,s=a+4+(i.outerWidth()+i.width())/2,r=o+4+(i.outerHeight()+i.height())/2,n=t.offset().left,d=t.offset().top,l=n+t.width(),c=d+t.height(),p=a>n&&o>d&&l>s&&c>r;return p},_set_width:function(i,t,a){return e(i).css({width:t,height:a})},_selection_resize_movement:function(e){var i=this._cropping.cropframe[0],t=e.clientX?e:e.originalEvent.touches[0],a={};if(a.width=this._cropping.w+t.clientX-this._cropping.x,this._in_parent()){var o=this._cropping.w+t.clientX-this._cropping.x,s=o/this.options.imageRatioWidth*this.options.imageRatioHeight;this.options.minWidth>=o&&(o=this.options.minWidth,s=o/this.options.imageRatioWidth*this.options.imageRatioHeight),i.style.width=o+"px",i.style.height=s+"px",this.width=o,this.height=s}else this.width=this.width>a.width?a.width:this.width,this.height=this.width/this.options.imageRatioWidth*this.options.imageRatioHeight,i.style.width=this.width+"px",i.style.height=this.height+"px"},_update_drag_position:function(e,i){var t=this._cropping.cropframe,a=this._cropping.cropbox,o=a.position().left,s=a.position().top,r=o-e,n=s-i;r>0?(r=0,e=o):a.width()+o<e+t.width()&&(r=t.width()-a.width(),e=o+a.width()-t.width()),n>0?(n=0,i=s):a.height()+s<i+t.height()&&(n=t.height()-a.height(),i=s+a.height()-t.height()),t.css({left:e,top:i})},_selection_drag_movement:function(e){var i=this,t=this._cropping.cropframe,a=(this._cropping.cropbox,e.pageX?e:e.originalEvent.touches[0]),o=t.position().left,s=t.position().top,r=a.pageX-i.mouseX+o,n=a.pageY-i.mouseY+s;i.mouseX=a.pageX,i.mouseY=a.pageY,i._update_drag_position(r,n)},_paintCanvas:function(){this._canvas.width=this._viewport.width,this._canvas.height=this._viewport.height,this._ctx.drawImage(this._image,0,0,this._viewport.width,this._viewport.height),e(this.element).find(".picedit_canvas").css("display","block")},_calculateCropWindow:function(){var e=this._viewport,i=this._cropping.cropframe[0],t={width:this._image.width,height:this._image.height},a={width:i.clientWidth,height:i.clientHeight,top:i.offsetTop>0?i.offsetTop:.1,left:i.offsetLeft>0?i.offsetLeft:.1};a.width+a.left>e.width&&(a.width=e.width-a.left),a.height+a.top>e.height&&(a.height=e.height-a.top);var o=a.width/e.width,s=a.height/e.height,r={width:parseInt(t.width*o,10),height:parseInt(t.height*s,10)},n=a.top/e.height,d=a.left/e.width;return r.top=parseInt(t.height*n,10),r.left=parseInt(t.width*d,10),r},_doRotation:function(e){var i,a,o=this,s=e*Math.PI/180,r=Math.cos(s),n=Math.sin(s);0>n&&(n=-n),0>r&&(r=-r),i=this._image.height*n+this._image.width*r,a=this._image.height*r+this._image.width*n;var d=t.createElement("canvas"),l=d.getContext("2d");d.width=parseInt(i,10),d.height=parseInt(a,10);var c=d.width/2,p=d.height/2;l.clearRect(0,0,d.width,d.height),l.translate(c,p),l.rotate(s),l.drawImage(this._image,-this._image.width/2,-this._image.height/2),this._image.src=d.toDataURL(o._images[o.active].type,this.options.quality),this._create_image_with_datasrc(d.toDataURL(o._images[o.active].type,this.options.quality),function(){o._images[o.active].dirty=!0,o._images[o.active].modified=!0,o._updateThumb()})},_resizeViewport:function(){var i=this._image,t={width:i.width,height:i.height};if(this.options.responsive){var a=this.$element.parent().width()/1.5;a>533&&(a=533),this.options.maxWidth=a,this.options.maxHeight=this.options.maxWidth*(this.options.imageRatioHeight/this.options.imageRatioWidth)}if("auto"!=this.options.maxWidth&&i.width>this.options.maxWidth&&(t.width=this.options.maxWidth),"auto"!=this.options.maxHeight&&i.height>this.options.maxHeight&&(t.height=this.options.maxHeight),this.options.aspectRatio){var o=i.width,s=i.height,r=o/s;o>t.width&&(t.width=parseInt(t.width,10),t.height=parseInt(t.width/r,10)),s>t.height&&(t.height=t.height>this.options.maxHeight?this.options.maxHeight:t.height,r=o/s,t.height=parseInt(t.height,10),t.width=parseInt(t.height*r,10))}var n=this.$element,d=(n.find(".image-container"),n.find(".pickedit_box_inner"));n.find(".pickedit_box_outer");this.options.preview&&d.css({width:t.width,height:t.height}),e(this.element).closest(""),this._viewport=t,this._setVariable("resize_width",i.width),this._setVariable("resize_height",i.height);var l=Function.prototype.call.bind(Object.prototype.toString);this.options.preview&&-1!==l(this._image).indexOf("HTMLImageElement")?this._paintCanvas():""},_thumbActive:function(e){this.$image_container.find(".thumb").removeClass("active").eq(e||this.active).addClass("active")},remove_image:function(i,t){var a,o=this,t=t;e(t),o.$image_container;o.active="number"==typeof i&&isFinite(i)&&Math.floor(i)===i?i:o.active;var s=o._images[o.active].name,r=o._images[o.active];r.removed=!0,o._images.splice(o.active,1);var n=o._images.length;return n>=1?(o.active=n-1,a=o._images[o.active].datasrc||o._images[o.active].rawsrc,o._images[o.active].datasrc?o._create_image_with_datasrc(a,function(){o._thumbActive(o.active+1),o.options.imageUpdated(r)}):o._create_image_with_datasrc(a,function(){o._thumbActive(o.active+1),o.options.imageUpdated(r),o._images[o.active].datasrc=""},!1,!0,!1)):(a=null,o._create_image_with_datasrc(a,!1,!1,!1,!1),o._image=!1,o.$element.removeClass("preview"),o.options.imageUpdated(r)),s},update_image:function(i){var t=this,i=i,a=e(i),o=t.$image_container.find(".thmb-photo-wrap img").index(a);if(t._images.length<=o)return t.$image_container.find(".thmb-photo-wrap #thumb"+o).remove(),!1;var s=t._images[o].datasrc||t._images[o].rawsrc;t.active!==o?(t.active=o,t._images[o].datasrc?t._create_image_with_datasrc(s,!1,!1,!1,!1):t._create_image_with_datasrc(s,!1,!1,!0,!1),t._thumbActive()):t._thumbActive()},_bindImage:function(){var i=this;i.isIOS?i.$image_container.on("touchend",".thumb",function(t){var a=this;setTimeout(function(){i.$element.hasClass("preview")&&!i.upload&&i.update_image(e(a).find("img"))},500)}):this.$image_container.on("mouseover",".thumb",function(t){i.$element.hasClass("preview")&&!i.upload&&i.update_image(e(this).find("img"))})},_updateThumb:function(){var i=this,t=e(i._image_container).find('[data-type="thumb_image"]'),a=i._images[i.active].datasrc;i._thumbActive(),t[i.active].src=a},update_tag:function(){arguments.length&&(this._images[this.active].category=parseInt(arguments[0],10))},removeAllTags:function(){var e=this,i=e._images.length;if(i>=0)for(var t=0;i>t;t++)e._images[t].category="",e.$image_container.find(".thumb").eq(t).removeClass("success")},_setVariable:function(i,t){this._variables[i]=t,e(this.element).find('[data-variable="'+i+'"]').val(t)},_soleUpload:function(t){var o=this;o.$image_container.find(".thumb").eq(t).addClass("blur");var s,r,n={},d={};if(o._theformdata=new FormData,o._images[t].dirty){s=o.options.inputName,r=o._dataURItoBlob(o._images[t].datasrc);var l=o._images[t].name;n[l]=o.options.imageType?o.options.imageType:o._images[t].category,d[l]=o._images[t].title,o._theformdata.append(s,r,l)}if(!o._images[t].dirty)return o.$image_container.find(".thumb").eq(t).removeClass("blur").addClass("success"),o.options.formSubmitted({data:"clean"}),!1;if("object"!=typeof n||!n[l])return o.set_messagebox(o.messageText.no_dirty_image),!1;o._theformdata.append("imagetypes",JSON.stringify(n)),o._theformdata.append("titles",JSON.stringify(d)),o._theformdata.append("objectType",o.options.objectType),o._theformdata.append("objectId",o.options.objectId),o._theformdata.append("addWaterMark",o.options.addWaterMark),o.$image_container.find(".thumb").eq(t).removeClass("tag");var c=new XMLHttpRequest;c.onprogress=function(e){if(e.lengthComputable)var i=e.total;else var i=Math.ceil(1.3*r.size);var t=Math.ceil(e.loaded/i*100);t>100&&(t=100)};var p=o.options.methodType?o.options.methodType:"post";c.open(p,o._theform.prop("action"),!0),c.onerror=function(e){o.set_messagebox(o.messageText.server_error+" : "+e)},c.onload=function(t){200!=this.status?o.set_messagebox(o.messageText.server_error+" : "+this.responseText):o.options.redirectUrl===!0?i.location.reload():o.options.redirectUrl&&(i.location=o.options.redirectUrl);var s,r;if(e.each(o._images,function(e){return o._images[e].name==l?(s=e,r=o._images[e].id,!1):void 0}),200===this.status&&s!==a){var n=JSON.parse(this.response);if(n=n[0],n.success){for(var d in n)n[d].data&&(o._images[s].id=n[d].data.id,o._images[s].dirty=!1,o.options.tagCheck&&e(o.element).find(".thumb").eq(s).data("title",o._images[s].id));o.$image_container.find(".thumb").eq(s).removeClass("blur").addClass("success")}else n.error&&o.$image_container.find(".thumb").eq(s).removeClass("blur").addClass("error")}else o.$image_container.find(".thumb").eq(s).removeClass("blur").addClass("error");o.options.formSubmitted(this,r)},o._images[t].dirty?c.send(o._theformdata):(o.$image_container.find(".thumb").eq(t).removeClass("blur").addClass("success"),o.options.formSubmitted({data:"clean"}))},_formsubmit:function(){if(i.FormData){var e=this;this.set_loading().delay(200).promise().done(function(){var i=e._images.length;if(i>=0){for(var t=0;i>t;t++)if(e.options.tagCheck&&(isNaN(e._images[t].category)||""==e._images[t].category))return e.set_messagebox(e.messageText.not_tagged),void e.$image_container.find(".thumb").removeClass("active").eq(t).addClass("active").find('input[data-type="inputBox"]').click();for(var a=0;i>a;a++)!function(i){e._images[i].datasrc?e._soleUpload(i):e.getDataUri(e._images[i].rawsrc,e._images[e.active].type,function(t){e._images[i].datasrc=t,e._soleUpload(i)})}(a)}})}else this.set_messagebox(this.messageText.formapi_error);return!1},_dataURItoBlob:function(e){if(!e)return null;for(var i=e.match(/^data\:(.+?)\;/),t=atob(e.split(",")[1]),a=new ArrayBuffer(t.length),o=new Uint8Array(a),s=0;s<t.length;s++)o[s]=t.charCodeAt(s);return new Blob([a],{type:i[1]})}},e.fn[s]=function(i){var t=arguments;if(i===a||"object"==typeof i)return this.each(function(){e.data(this,"plugin_"+s)||e.data(this,"plugin_"+s,new o(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var r;return this.each(function(){var a=e.data(this,"plugin_"+s);a instanceof o&&"function"==typeof a[i]&&(r=a[i].apply(a,Array.prototype.slice.call(t,1))),"destroy"===i&&e.data(this,"plugin_"+s,null)}),r!==a?r:this}}}(jQuery,window,document),define("picedit",function(){}),define("modules/imageProcessing/scripts/index",["text!modules/imageProcessing/views/index.html","modules/controls/scripts/controlsService","picedit"],function(e,i){Box.Application.addModule("imageProcessing",function(t){"use strict";function a(e,i){return"function"==typeof h[p.id][e]?h[p.id][e](i):!1}function o(){var e=p.selector||".picedit_box";c.find(e).picEdit({imageUpdated:function(e){t.broadcast("image_updated",{image:e,id:p.id}),c.find(".thumb").length===p.maxImages?c.find(".js-plus-thumb").addClass("hide"):c.find(".js-plus-thumb").removeClass("hide")},formSubmitted:function(e,i){t.broadcast("images_submitted",{xhr:e,id:p.id,imageId:i})},start:function(e){h[p.id]=e},getMessage:function(e){t.broadcast("get_message",{msg:e,id:p.id})},redirectUrl:p.redirectUrl||!1,maxSize:p.maxSize||35e5,allowedTypes:p.allowedTypes||["image/jpeg","image/png","image/jpg"],quality:p.quality||.6,imageRatio:p.imageRatio||"4:3",multi:p.multi||!1,preview:p.preview||!1,tagCheck:p.tagCheck||!1,imageType:p.imageType,fullCrop:p.fullCrop||!1,aspectRatio:p.aspectRatio||!0,responsive:p.responsive||!0,maxWidth:p.maxWidth,maxHeight:p.maxHeight,maxImages:p.maxImages||6,imgMinWidth:p.imgMinWidth,imgMinHeight:p.imgMinHeight,addWaterMark:p.addWaterMark&&!0,objectType:p.objectType,objectId:p.objectId,defaultImage:p.defaultImage||!1,methodType:p.methodType,imageId:p.imageId||"",deviceType:p.deviceType||""})}function s(e){var i=d.trim(d(e).data("images"));return i="undefined"!=typeof i&&""!=i?i.split(","):!1,"object"==typeof i&&i instanceof Array?!0:!1}function r(e,i){var t=c.find(".picedit_box"),o=c.find(".btn.back"),s=t.hasClass("crop");return"preview_open"===e||s?o.removeClass("hidden"):o.addClass("hidden"),a(s?"crop_close":e)}function n(e){if(d(e).closest(".thumb").hasClass("active")){var i=(a("remove_image",c.find(".thumb").index(d(e).closest(".thumb"))),h[p.id]._titleimage);-1===i&&(c.find("#title-image").prop("checked",!1),t.broadcast("title_image",{title:i,id:p.id}))}}var d,l,c,p={},h={},m=Box.Application;return{init:function(){d=t.getGlobal("jQuery"),p=t.getConfig(),l=t.getElement(),c=d(l);var a=doT.template(e)({preview:p.preview,maxImages:p.maxImages,isScreening:i.get("isScreening"),id:p.id});if(c.append(a),o(),p.imageId){var s=c.find("form");s.attr("action",s.attr("action")+"/?imageId="+p.imageId)}t.broadcast("moduleLoaded",{name:"imageProcessing"}),t.broadcast("imageUploadReady")},destroy:function(){var e=c.find('script[type="text/x-config"]');c.html(e)},onclick:function(e,i,t){switch(t){case"crop_open":case"rotate_cw":case"rotate_ccw":d(i).closest(".thumb").hasClass("active")&&a(t);break;case"load_image":case"crop_image":case"crop_close":case"camera_open":a(t);break;case"remove_image":n(i);break;case"set_default_image":return s(i)?a(t,images):this.setMessage("Please provide comma seprated list of images");case"preview_open":h[p.id]._images.length>0?m.broadcast(t,{id:p.id}):"";break;case"preview_close":m.broadcast(t,{id:p.id});break;case"remove_all":a(t),a("preview_close");break;case"show-approved":var o=d(document).find(".verifiedImage"),r=d(document).find("#show-approved-btn");"show"===i.dataset.value?(o.removeClass("hide"),r.text("Hide Approved Images"),r.attr("data-value","hide")):(o.addClass("hide"),r.text("Show Approved Images"),r.attr("data-value","show"))}},onchange:function(e,i,t){switch(t){case"update_tag":a(t)}},setMessage:function(e){a("set_messagebox",e)},messages:["preview_open","image_action","preview_close","camera_open","load_image","update_tag","form_submit","set_default_image","set_title_image","set_image_title","image_upload_reset","remove_image","removeAllTags"],onmessage:function(e,i){switch(e){case"preview_open":case"preview_close":p.id===i.id?r(e,i):"";break;case"image_action":case"camera_open":case"load_image":p.id===i.id?a(e):"";break;case"form_submit":if(i.id!=l.id)return;t.broadcast("images_data",{images:h[p.id]._images,id:p.id}),a(e);break;case"update_tag":if(i.id!=l.id)return;a("update_tag",i.value);break;case"set_default_image":if(i.id!=l.id)return;a("set_default_image",i.value);break;case"set_title_image":if(i.id!=l.id)return;h[p.id]._settitleimage=i.value;break;case"set_image_title":if(i.index>-1){var o=h[p.id]._images.length;o>0?(h[p.id]._images[i.index].title=i.value,t.broadcast("images_count",{id:p.id,count:o,titleText:i.value})):t.broadcast("images_count",{id:p.id,count:0,titleText:i.value})}break;case"image_upload_reset":p.id===i.id&&a("reset");break;case"remove_image":if(i.id!=l.id)return;var s=i.element;n(s);break;case"removeAllTags":a("removeAllTags")}}}})});